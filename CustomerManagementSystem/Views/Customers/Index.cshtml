@model CustomerReportDto

@{
    ViewBag.title = "Customer List";
}

@section page_specific_style {


    <style>
        .country-select:disabled {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background: transparent;
            border: none;
            box-shadow: none;
            padding-left: 0;
            color: #000;
            font-weight: 500;
            pointer-events: none;
        }
    </style>
}

<div class="container-fluid">
    <div class="listTopFlex">
        <h5>
            Customer List
        </h5>
        <div class="listAct">
            <div class="seah">
                <input class="form-control form-control-sm" type="search" id="searchit" placeholder="Search...">
                <label for="searchit"><i class="bx bx-search"></i></label>
            </div>

        </div>
    </div>
    <div>
        <div id="divindex">
        </div>
    </div>



</div>


@section Scripts {
    <script>

        const IssuedPustikaUrl = '@Url.Action("CustomerTablePartial", "Customers")';

    </script>
    <script src="~/js/customerFilter.js"></script>
    <script>

            $(document).on('click', '.btn-edit', function () {
            var btn = $(this);
            var row = btn.closest('tr');
            var isEditMode = btn.text().trim() === 'Update';

            var countrySelect = row.find('.country-select');

            if (isEditMode) {
                // Enable text fields
                row.find('[data-field]')
                    .attr('contenteditable', true)
                    .addClass('editable-active');

                // ✅ Enable country dropdown
                countrySelect.prop('disabled', false);

                btn.text('Save')
                   .removeClass('btn-primary')
                   .addClass('btn-success');
            }
            else {
                var customer = {
                    CustomerID: row.data('id'),
                    FirstName: row.find('[data-field="FirstName"]').text().trim(),
                    LastName: row.find('[data-field="LastName"]').text().trim(),
                    Email: row.find('[data-field="Email"]').text().trim(),
                    Phone: row.find('[data-field="Phone"]').text().trim(),
                    CountryID: countrySelect.val()
                };

                $.ajax({
                    url: '/Admin/Update',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(customer),
                    success: function () {

                        // Disable text fields
                        row.find('[data-field]')
                            .removeAttr('contenteditable')
                            .removeClass('editable-active');

                        // ✅ Disable dropdown again
                        countrySelect.prop('disabled', true);

                        btn.text('Update')
                           .removeClass('btn-success')
                           .addClass('btn-primary');
                    },
                    error: function () {
                        alert('Update failed');
                    }
                });
            }
        });






    </script>
    <script>
                    $(document).ready(function () {
            console.log("hello");

            $(document).on('click', '.btn-delete', function () {

                if (!confirm('Are you sure?')) return;

                var row = $(this).closest('tr');
                var id = row.data('id');
                console.log(id);

                $.ajax({
                    url: '/Admin/Delete',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(id),
                    success: function () {
                        row.fadeOut(300, function () {
                            $(this).remove();
                        });
                    },
                    error: function () {
                        alert('Delete failed');
                    }
                });
            });
        });

    </script>
}



